    var currentDate = new Date(); // сегодня
    var summerDate = new Date(2018, 12, 1); // 7 октября
    // console.log(summerDate);
    // console.log(+new Date);
    var targetDate = (currentDate > summerDate) ? currentDate : summerDate; // countdown будет нулевым, если 1 июня уже наступило/прошло
    var timer = countdown(targetDate, null, countdown.WEEKS | countdown.DAYS); // время до наступления даты
    var initState = 'scrollEnabled'; // состояния скролла
    var selectors = [ // ассоциативный массив селекторов для timeParser
      '#circle1',
      '#circle2',
      // '#circle3',
      // '#circle4',s
      // '#circle5',
    ];
    var timeMapKeys = [ // ещё один ассоциативный массив для timeParser
      // 'month',
      'week',
      'day',
      // 'hour',
      // 'min',
      // 'sec'
    ];


function toTimestamp(strDate){
   // var datum = Date.parse(strDate);
   // console.log(new Date().getDay())
   // return datum/1000;
}


function blabla(){
  var now = new Date();
      console.log(now.getHours());
  switch (now.getDay()) {
    case 5: 
      

  }

}

blabla();
// console.log(toTimestamp(new Date()));

$(".accor-el:first").find('input').attr('checked','checked');
    

    $(document).ready(function ($) {
      timeParser(selectors, timeMapKeys);
      animateElements();
      $(window).scroll(animateElements);
      // $(".accor-el:first").find('input').attr('checked','checked');

      var options1 = {
        rules: {
          popup_email: {
            required: true,
            email: true
          },
          "popup_email-confirm": {
            required: true,
            email: true,
            equalEmailIgnoreCase: true
            
            // equalTo: ".popup_email"
          },
        //   "popup_email-confirm": {
            
        //   },
          
          "offer_accept_online": {
            required: true
          },
          popup_city: {
            required: true,
            valueNotEquals: ""
          }
        },
        messages: {
          popup_email: {
            // required: "Введите Вашу почту",
            // email: "Неверный формат почты (example@domain.ru)"
            required: "",
            email: ""
          },
          "popup_email-confirm": {
            // required: "Введите почту повторно",
            // email: "Неверный формат почты (example@domain.ru)",
            // equalTo: "Значения не совпадают"
            required: "",
            email: "",
            equalEmailIgnoreCase: ""
            // equalTo: ""
          },
          "offer_accept_online": {
            required: "Требуется Ваше согласие"
          },
          popup_city: {
            required: "",
            // valueNotEquals: "Выберите город"
            valueNotEquals: ""
          }
        }
      };
      var options2 = {
        rules: {
          popup_name: {
            required: true,
            minlength: 3
          },
          popup_surname: {
            required: true,
            minlength: 3
          }
        //   pegi_eighteen: {
        //     required: true
        //   }
        },
        messages: {
          popup_name: {
            // required: "Введите Ваше имя",
            // minlength: "Поле должно иметь не менее трёх символов"
            required: "",
            minlength: ""
          },
          popup_surname: {
            // required: "Введите Вашу фамилию",
            // minlength: "Поле должно иметь не менее трёх символов"
            required: "",
            minlength: ""
          }
        //   pegi_eighteen: {
        //     required: "Подтвердите Ваш возраст"
        //   }
        }
      };
      var options3 = {
        rules: {
          popup_link: {
            required: true
            // checkUrl: true
          }
        },
        messages: {
          popup_link: {
            // required: "Введите ссылку",
            // checkUrl: "Неверный формат ссылки (t.me/your_id, vk.com/your_id)"
            required: ""
            // checkUrl: "Неверный формат ссылки (t.me/your_id, vk.com/your_id)"
          }
        }
      };

      $('#form-popup1').validate(options1);
      $('#form-popup2').validate(options2);
      $('#form-popup3').validate(options3);


    $('#form_step4 .promocode-text').click(function() {
        $(this).css('visibility', 'hidden');
        $('#form_step4 .form__input').css('visibility', 'visible');
    });
    
    $('.form-promocode').click(function() {
      $('#form_step4 .promocode-text').css({'visibility':'hidden'});
      $('#form_step4 .form__input').css({'visibility':'visible'});
    })


      var validState = false;
      var Data_form = [];

      function pushDataForm(form) {
        Data_form = Data_form.concat($(form).serializeArray());
        console.log(Data_form);
      }

      $('#form-popup1').on('submit', function (e){

          e.preventDefault();



          if ($(this).valid()) {
            validState = true;
          } else {
          	return false;
          }
          pushDataForm(this);
          $.ajax({
            url: '/s60-email',
            data: Data_form,
            type: "POST",
            cache: false,
            success: function (){
              // console.log('op');      
            }
          });
          return false;
        });

      $('#form-popup2').on('submit', function (e){
          e.preventDefault();
          if ($(this).valid()) {
            validState = true;
          }
          pushDataForm(this);
          return false;
        });

      $('#form-popup3').on('submit', function (e){
          e.preventDefault();
          if ($(this).valid()) {
            validState = true;
          }
          pushDataForm(this);
          return false;
        });

      $('#form-popup4').on('submit', function (e){
          e.preventDefault();
          if ($(this).valid()) {
            validState = true;
          }
          pushDataForm(this);
           $.ajax({
            url: '/s60-email',
            data: Data_form,
            type: "POST",
            dataType: "JSON",
            cache: false,
            success: function (data){
              window.location = '/payment?order_id=' + data.order_id;      
            }
          });
          // Data_form = Object.assign(Data_form, form4);
          return false;
        });



    //   $("form").each(function () {
    //     $(this).on('submit', function (e) {
    //       preventDefault(e);

    //       if ($(this).valid()) {
    //         validState = true;
    //     });
    //   });





    /* костыль для адаптива, менять вертску долго */
    // if ($(window).width() <= '767') {
    // 	$('#sixty_days-wr #composition-body .block3').fadeOut();
    // 	$('#sixty_days-wr #composition-body .block3.vk_chat').fadeIn();
    // };



      // Проклик элемента, отвечающего за поведение popup'а
      $('.poplight').click(function (e) {
        e.preventDefault();
		// document.body.style.overflow = 'scroll';
		// document.body.style.height = '100%';
		// document.body.style.width = '100%';
		// document.body.style.position = 'fixed';


        var popupParent = $(this).parents('.popup_block'); // поиск родителя - popup-блока
        var popID = $(this).attr('rel'); // получаем имя окна, важно не забывать при добавлении новых менять имя в атрибуте rel ссылки
        var popURL = $(this).attr('href'); // получаем размер из href атрибута ссылки
        var query = popURL.split('?'); // выдираем строку (переменные из href) 
        var dim = query[1].split('&'); // распарсенные переменные из href 
        var popWidth = dim[0].split('=')[1]; // первое значение строки запроса
        var mobileWidth = dim[1].split('=')[1];
        var isMobile = $(window).width() <= '560';
        
        // блокируем скролл фона
        // document.body.style.overflow = 'hidden';
        // $('body').css({'overflow':'hidden'});
        
        // $('body').addClass('noscroll');
        document.body.classList.add('no-scroll');
        document.scrollTop = window.pageYOffset; // запоминаем текущую прокрутку сверху
        if ( document.body.style.position !== 'fixed') {
                    document.body.style.position = 'fixed';
        document.body.style.top = -document.scrollTop + 'px';
        }



        // initState = toggleEnablingScroll('scrollEnabled');

        // если кнопка в popup'е, делаем валидацию
        // если валидация успешна, переключаем popup
        if (popupParent.length > 0) {
          if (!$(this).hasClass('back')) {
            var targetForm = $(popupParent).find('form');

            if (targetForm.length > 0) {
              targetForm.submit();

              if (validState) {
                validState = false;

                popupParent.css({
                  "display": "none"
                });
              } else {
                return;
              }
            }
          } else {
            popupParent.css({
              "display": "none"
            });
          }
        }

        // показать popup
        $('#' + popID).fadeIn()
        // $('#' + popID).fadeIn().css({
        //   'display': 'flex', 
        //   'flex-direction': 'column',
        //   'width': '100% !important',
        //   'justify-content': 'space-around',
        //   'width': isMobile ? '100%' : 'Number(popWidth)',
        //   'overflow': isMobile ? 'scroll' : 'Number(popWidth)'
        // });



        // Выравнивание по центру - добавляем к высоте/ширине с учетом отступов + ширина рамки
        var popMargTop = ($('#' + popID).height() + 100) / 2;
        var popMargLeft = ($('#' + popID).width() + 100) / 2;

        // Устанавливаем величину отступа
        // $('#' + popID).css({
        //   'margin-top': isMobile ? 0 : -popMargTop,
        //   'margin-left': isMobile ? 0 : -popMargLeft
        // });
        
        // Добавляем полупрозрачный фон затемнения
        !($('#fade').length > 0) && $('body').append('<div id="fade"></div>'); // div контейнер будет прописан перед тегом </body> (один раз)
        $('#fade').css({
          'filter': 'alpha(opacity=80)'
        }).fadeIn(); //полупрозрачность слоя, фильтр для IE

        return false;
      });
	$('.close').click(function(e){
		$('#form_step1').fadeOut();
		$('#fade').fadeOut();
	  document.body.classList.remove('no-scroll');
	  document.body.style.position = '';
	  document.body.style.width = '';
	  document.body.style.top = '';
	  window.scroll(0, document.scrollTop);
	});
	$('.fade').click(function(e){
	  $('#form_step1').fadeOut();
	  $('#fade').fadeOut();
	  document.body.classList.remove('no-scroll');
	  document.body.style.position = '';
	  document.body.style.width = '';
	  document.body.style.top = '';
	  window.scroll(0, document.scrollTop);
});



	// if($('#popup_city').val()=="Москва") {
	//     $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА МСК»');
	//     $("#form-popup4 .executor").find('a').attr('href', 'http://msk.sektaschool.ru/dokumentyi');
	//     $('#popup_city').closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_msk.pdf');
	// } else if ($('#popup_city').val()=="Санкт-Петербург") {
	//     $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА СПБ»');
	//     $("#form-popup4 .executor").find('a').attr('href', 'http://spb.sektaschool.ru/dokumentyi');
	//     $('#popup_city').closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_spb.pdf');
	// } 
	

  if($('#popup_city').val()=="Москва" || $('#popup_city').val()=="Санкт-Петербург") {
      // $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА МСК»');
      $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА СПБ»');
      $("#form-popup4 .executor").find('a').attr('href', 'http://spb.sektaschool.ru/dokumentyi');
      $('#popup_city').closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_spb.pdf');
  } 

      
    /* Изменение оферты от выбора селекта */
      $('#popup_city').on('change', function(){
        if($(this).val()=="Москва") {
            // $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА МСК»');
            // $("#form-popup4 .executor").find('a').attr('href', 'http://msk.sektaschool.ru/dokumentyi');
            // $(this).closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_msk.pdf');
            $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА СПБ»');
            $("#form-popup4 .executor").find('a').attr('href', 'http://spb.sektaschool.ru/dokumentyi');
            $(this).closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_spb.pdf');
        } else if ($(this).val()=="Санкт-Петербург") {
            $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА СПБ»');
            $("#form-popup4 .executor").find('a').attr('href', 'http://spb.sektaschool.ru/dokumentyi');
            $(this).closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_spb.pdf');
        } else if ($(this).val()=="Другой классный город") {
            $("#form-popup4 .executor").find('a').html('ООО «ШКОЛА ИДЕАЛЬНОГО ТЕЛА Регионы»');
            $("#form-popup4 .executor").find('a').attr('href', 'http://reg.sektaschool.ru/dokumentyi');
            $(this).closest('form').find('#offer_accept_online__label').find('a').attr('href', 'http://sektaschool.ru/site/docs/publicoffer_reg.pdf');
        } else {
        	$(this).closest('form').find('#offer_accept_online__label').find('a').css({'pointer-events':'none'});

        }
      });



      // EVENTS LISTENERES BY DOCUMENT ONLOAD -------------------------------------------------

      // карусель двигается вправо
      $('.results-next').click(function () {
        $('.owl-carousel').trigger('next.owl.carousel')
      });

      // карусель двигается влево
      $('.results-prev').click(function () {
        $('.owl-carousel').trigger('prev.owl.carousel')
      });

      // скролл к функциональному блоку с popup'ами 
      $('.scroll-to-second-btn').click(function () {
        $('html, body').animate({
          scrollTop: $("#record-wr").offset().top
        }, 1000);
      });

      // Закрываем окно и фон затемнения
      $(document).on('click', 'a.close, #fade', function () {
        initState = toggleEnablingScroll('scrollDisabled');
        $('#fade , .popup_block').fadeOut(function () {
          $('#fade').remove();
        });
        return false;
      });

      // доступ к кнопкам клавиатуры при фокусе инпута
      $(document).on('focus', 'input', function () {
        if (initState === 'scrollDisabled') {
          document.onkeydown = null;
        }
        return false;
      });

      // анулирование доступа к кнопкам клавиатуры по потере фокуса инпута
      $(document).on('blur', 'input', function () {
        if (initState === 'scrollDisabled') {
          document.onkeydown = preventDefaultForScrollKeys;
        }
        return false;
      });
    });

    // CONFIGS AND USEFULL FUNCTIONS BY SCRIPT LOAD -------------------------------------------------

    // конфиги для jquery.validate.js
    $.validator.setDefaults({
      highlight: function (element) {
        $(element)
          .closest('.form__input')
          .addClass('has-error');
        $(element).closest('.mdl').addClass('has-error');  
        // $(element).closest('.mdl').addClass('has-error'); 
        // document.scrollTop = window.pageYOffset; // запоминаем текущую прокрутку сверху
        // document.body.style.top = -document.scrollTop + 'px';
        $(element)
          .closest('.form__input')
          .removeClass('success');
      
          $(element)
          .closest('.select_block')
          .addClass('has-error');
        $(element)
          .closest('.select_block')
          .removeClass('success');
      },
      unhighlight: function (element) {
        $(element)
          .closest('.form__input')
          .removeClass('has-error');
        $(element).closest('.mdl').removeClass('has-error');    
        $(element)
          .closest('.form__input')
          .addClass('success');

        $(element)
          .closest('.select_block')
          .removeClass('has-error');
        $(element)
          .closest('.select_block')
          .addClass('success');
      },
      errorPlacement: function (error, element) {
        error.insertBefore($(element).parent());
      }
    });

    $.validator.addMethod("valueNotEquals", function (value, element, arg) {
      return arg !== value;
    }, "Value must not equal arg.");

    $.validator.addMethod("checkUrl", function (value, element) {
      return /^((https?:\/\/)(www.)?)?[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(:[0-9]{1,5})?(\/.*)?$/.test(value);
    }, "Please enter a valid URL.");
    
    $.validator.addMethod("equalEmailIgnoreCase", function(value, element){
        return value.toLowerCase() == $('.popup_email').val().toLowerCase();
    },""); 
    
    
    // конфиги для owl.carousel.js
    $('.owl-carousel').owlCarousel({
      items: 1,
      itemsDesktop: false,
      itemsDesktopSmall: false,
      itemsTablet: false,
      itemsMobile: false,
      loop: true,
      margin: 0,
      nav: false,
      dots: true,
      dotsEach: true
    })

    // заполняет указанные селекторы характерным для конкретного селектора временем 
    function timeParser(selectors, timeMapKeys) {
      var timeMap = {
        // 'month': ['#circle1', 'месяц', 'месяца', 'месяцев', timer.months, 12],
        'week': ['#circle1', 'неделя', 'недели', 'недель', timer.weeks, 21],
        'day': ['#circle2', 'день', 'дня', 'дней', timer.days, 7],
        // 'hour': ['#circle2', 'час', 'часа', 'часов', timer.hours, 24],
        // 'min': ['#circle4', 'минута', 'минуты', 'минут', timer.minutes, 60],
        // 'sec': ['#circle5', 'секунда', 'секунды', 'секунд', timer.seconds, 60]
      };

      for (key in timeMap) {
        selectors.map(function(selector) {
          if (timeMap[key][0] === selector) {
            // key внутри события принимает значение последнего элемента timeMap
            var keyTmp = key;

            $(selector).on('circle-animation-progress', function (event, progress, stepValue) {
              // var currentVal = Math.round(timeMap[keyTmp][4] * progress);
              var timerVal = timeMap[keyTmp][4];
              var factor = timeMap[keyTmp][5];
              var remainder = timerVal % 10;
              var tenCount = Math.floor(timerVal / 10);
              var tickVal = tenCount * 10 + remainder;
              var text;

              timeMapKeys.map(function(time) {
                if (time === keyTmp) {
                  // 1, 21, 31 
                  if (tenCount !== 1 && timerVal % 10 === 1) {
                    text = timeMap[keyTmp][1];
                  }
                  // 2,3,4, 22,23,24 
                  if ((1 < timerVal && timerVal < 5) ||
                    (tenCount > 1 &&
                      (tenCount * 10 + 1 < tickVal) && (tickVal < tenCount * 10 + 5))) {
                    text = timeMap[keyTmp][2];
                  }
                  // 0,5..20 
                  if (tenCount === 1 || timerVal % 10 === 0 ||
                    (tenCount * 10 + 5 <= tickVal) && (tickVal <= tenCount * 10 + 9)) {
                    text = timeMap[keyTmp][3];
                  }
                }
              });

              $(this).find('strong').html(Math.round((1 - stepValue.toFixed(2)) * factor) + '</br>' +
                text);
            })
          }
        })
      }
    }

    // анимация загрузки круговых лоадеров при скролле до блока
    function animateElements() {
      $('.circles').each(function () {
        var elementPos = $(this).offset().top;
        var topOfWindow = $(window).scrollTop();
        var animate = $(this).data('animate');
        var value;
        var size;

        if (elementPos < topOfWindow + $(window).height() - 100 && !animate) {
          switch ($(this).attr('id')) {
            case 'circle1':
              {
                // value = timer.months / 12;
                // value = 1 - timer.weeks / 21;
                value = 1 - timer.weeks / 21;
                size = 130;
                break;

              }
            case 'circle2':
              {
                // value = 1 - timer.days / 7;
                value = 1 - timer.days / 7;
                size = 100;
                break;
              }
            //   }
              // case 'circle3':
              //   {
              //     value = timer.hours / 24;
              //     size = 100;
              //     break;
              //   }
              // case 'circle4':
              //   {
              //     value = timer.minutes / 60;
              //     size = 100;
              //     break;
              //   }
              // case 'circle5':
              //   {
              //     value = timer.seconds / 60;
              //     size = 100;
              //     break;
              //   }
            default:
              {
                value = 1;
              }

          }

          $(this).data('animate', true);
          $(this).circleProgress({
            startAngle: -Math.PI / 2,
            value: value,
            size: size,
            lineCap: 'round',
            fill: {
              gradient: ["#ff364e", "#a72bbb"],
              gradientAngle: -Math.PI / 2
            },
            emptyFill: "rgba(0, 0, 0, 0.05)"
          });
        }
      });
    }

    // left: 37, up: 38, right: 39, down: 40,
    // spacebar: 32, pageup: 33, pagedown: 34, end: 35, home: 36
    var keys = {
      37: 1,
      38: 1,
      39: 1,
      40: 1
    };

    function preventDefault(e) {
      e = e || window.event;
      if (e.preventDefault) {
        e.preventDefault();
      }
      e.returnValue = false;
    }

    function preventDefaultForScrollKeys(e) {
      if (keys[e.keyCode]) {
        preventDefault(e);
        return false;
      }
    }

    function toggleEnablingScroll(initState) {
      if (initState === 'scrollEnabled') {
        if (window.addEventListener) { // older FF
          window.addEventListener('DOMMouseScroll', preventDefault, false);
        }

        window.onwheel = preventDefault; // modern standard
        window.onmousewheel = document.onmousewheel = preventDefault; // older browsers, IE
        window.ontouchmove = preventDefault; // mobile
        document.onkeydown = preventDefaultForScrollKeys;
        initState = 'scrollDisabled';

        return initState;
      } else {
        if (window.removeEventListener) {
          window.removeEventListener('DOMMouseScroll', preventDefault, false);
        }

        window.onmousewheel = document.onmousewheel = null;
        window.onwheel = null;
        window.ontouchmove = null;
        document.onkeydown = null;
        initState = 'scrollEnabled';

        return initState;
      }
    }
    



function showKursePrices(pack, $select, sale, week_first, week_last) {
    if (!pack) {
        pack = false;
    }
    if (!$select) {
        $select = $('#select-online-kurse_modal');
    }
    $select.find('option').each(function() {
        if ($(this).prop('selected') == true) {
            dataId = ($(this).attr('data-id'));
            countWeeks = ($(this).attr('data-count-weeks'));
        }
    });

    if (!week_last) {
        week_last = countWeeks;
    }
    if (!week_first) {
        week_first = 1;
    }

    sale = !sale ? 0 : (sale / 100).toFixed(3);
    kursePrice = window["kurse_" + dataId];
    weekPrices = '';
    kursePriceTotal = 0;

    if (pack) {
        var totalPack = 0;
        var kursePrice_copy = {};
        for (var i = 1; i <= countWeeks; i++) {
            week_sale = 0;
            if (i >= week_first && i <= week_last) {
                week_sale = (kursePrice[i] * sale);
            }
            kursePrice_copy[i] = kursePrice[i] - week_sale;

            totalPack += +kursePrice_copy[i];

            if (i == 1) {

                weekPrices += '<option value="111">' + i + ' ' + 'неделю' + ' — ' + kursePrice_copy[i] + ' руб.</option>';

            } else if (i == 5) {
                kursePriceTotal = +kursePrice_copy[2] + +kursePrice_copy[3] + +kursePrice_copy[4] + +kursePrice_copy[5]
                weekPrices += '<option value="112"> пакет 2-5 неделя' + ' — ' + kursePriceTotal + ' руб.</option>';
            } else if (i == 9) {
                kursePriceTotal = +kursePrice_copy[6] + +kursePrice_copy[7] + +kursePrice_copy[8] + +kursePrice_copy[9]
                weekPrices += '<option value="113"> пакет 6-9 неделя' + ' — ' + kursePriceTotal + ' руб.</option>';

            }
            ;

        }

        weekPrices += '<option value="114"> цена за весь курс' + ' — ' + totalPack + ' руб.</option>';

    } else {

        for (var i = 1; i <= countWeeks; i++) {
            var countWeekName;

            if (i == 1) {
                countWeekName = 'неделю';
            } else if (i >= 2 && i <= 4) {
                countWeekName = 'недели';
            } else {
                countWeekName = 'недель';
            }
            week_sale = 0;
            if (i >= week_first && i <= week_last) {
                week_sale = (kursePrice[i] * sale);
            }
            Price_sale = kursePrice[i] - week_sale;
            kursePriceTotal += Math.ceil(+Price_sale);
            weekPrices += '<option value=' + i + '>' + i + ' ' + countWeekName + ' — ' + kursePriceTotal + ' ₽</option>';
        }

    }

    $select.closest('form').find('.paid_weeks').html(weekPrices);
    console.log(weekPrices);

}
showKursePrices();


